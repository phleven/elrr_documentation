elrr (Enterprise Learner Record Repository) setup


Use Java 17
Install Dependencies
Clone Remote Git Repository
Create a new Eclipse Workspace
Import Project Into Eclipse
Create Docker Containers (Docker compose)
Create and populate PostgreSQL staging schema
Run elrrexternalservices
Application UI
Run elrrexternalservices
Run elrrdatasynch
Run elrraggregation
Run Postman to populate lrs-db
Remove Application from Docker
View runnung Docker containers
View Kafka topics
View Kafka topic messages
KafkaMagic



Use Java 17:
   c. java -version
   d. echo $JAVA_HOME



Install Dependencies:
1. Install git
   a. Run Git-2.53.0-64-bit.exe
      1. Destination Location = C:\Program Files\Git
      2. Use Notepad as Git's default editor
      3. Override the default branch name for new repositories = main
      4. Select Git from the command line and also 3rd party software
      5. Select Use bundled OPenSSH
      6. Select Use native Windows Secure Channel library 
      7. Select Checkout Windows-style, commit Unix-style line endings
      8. Select Use MinTTY
      9. Select Fast-forward or merge
     10. Select Git Credential Manager
     11. Select Enable file system caching 
   b. Open Terminal
      1. cd C:\Users\phleven\git\elrrserviceentities
      2. git install
      3. git config --global user.email "phleven@deloitte.com"
      4. git config --global user.name "Leven"
      
2. Install Maven
   a. Unzip apache-maven-3.9.12-bin.zip to C:\
   b. SET M2_HOME=C:\apache-maven-3.9.12
   c. SET M2=%M2_HOME%\bin
   d. Add C:\apache-maven-3,9.12\bin to path

3. Install Docker Desktop
   a. Windows key + R --> appwiz.cpl --> Turn Windows features on or off
      1. Check Hyper-V Platform 
      2. Check Virtual machine platform
      
   b. Reboot

   c. Run Docker Desktop Installer.exe
      1. Check Use WSL-2 instead ofHyper-V (recommeded)
      2. Check add shortcut to desktop
      
   d. Reboot
   
   e. Open terminal
      1. wsl --update
         a. New UNIX username = phleven
         b. New password = Cynthia1#


         
Create a new Eclipse Workspace:
1. Open Eclipse

   a. Set Java version in Eclipse
      1. Eclipse --> Window --> Preferences --> Java --> Installed JREs
         a. Check jdk-17 (default)
         b. Right click on ellraggrigator --> Properties --> Project Facets
            1. Java = 17 --> Apply and Close
            
   b. Show all files
       1. Package Explorer --> 3 dots --> Filters --> un-check .* resources
       
   c. Set Light Theme
      1. Eclipse --> Window --> Preferences --> General --> Apperance
         a. Theme = Light
       
   d. Set Eclipse Formatting
      1. Eclipse --> Window --> Preferences --> Java --> Code Style --> Formatter
         a. Edit
		    1. Profile name = Eclipse ELRR
		
		    2. Indentation --> Tab = Spaces only
		
		    3. Indentation --> Indentation size = 4
		
		    4. Indentation --> Tab = 4
		
		
		    5. Line Wrapping --> Maximum line width = 80
		         
		    6. Line Wrapping --> Default Indentation for Wrapped = 2
		
		    7. Line Wrapping --> Uncheck Prefer wrapping outer expressions (keep nested expressions on one line)
		
		
		    8. Wrapping Setings --> Method declaration --> Declaration --> Wrap where necessary
		
		    9. Wrapping Setings --> Method declaration --> throws --> Wrap where necessary
		      
		
		   10. Wrapping Setings --> Annotations --> On methods --> Wrap where necessary
		
		   11. Wrapping Setings --> Annotations --> On parameters --> Wrap where necessary
		   
		   12. Wrapping Setings --> Annotations --> Element value pairs --> Wrap where necessary
		   


           13. Comments --> Maximum width for comments = 80
     
           14. Comments --> Uncheck Enable JavaDoc comment formatting
           
   e. Add Lombok Plugin to Eclipse:
      1. Eclipse --> Help --> Install New Software --> Add
         a. Name = Lombok
         b. Location = https://projectlombok.org/p2

   f. Install Checkstyle Eclipse Plugin:
      1. Eclipse --> Help --> Install New Software --> Add
         a. Name = Checkstyle
         b. Location = https://checkstyle.org/eclipse-cs-update-site
         
   g. Install Eclipse Color Themes Plugin:
      1. Eclipse --> Help --> Install New Software --> Add
         a. Name = Eclipse Color Themes
         b. Location = https://eclipse-color-theme.github.io/update/
      2. Eclipse --> Window --> Preferences --> General --> Apperance --> Color Theme
         a. Select Solarized Light



Import Project into Eclipse
elrr_documentation
------------------
      1. Eclipse --> File --> Import --> Git --> Projects from Git --> Clone URI
         a. URI = https://github.com/phleven/elrr_documentation.git
         b. User = phleven
         c. Password = phil55.cindy61
         d. Select main branch, deselect all other branches
         e. Local Destination = C:\Users\phleven\git\elrr_documentation

      2. Eclipse --> Show View --> Git Repositories --> Right click on elrrdocumentation 
	--> Working Tree - C:\Users\phleven\git\elrrdocumentation\.git --> Import Projects 
         a. Import source = C:\Users\phleven\git\elrrdocumentation
         b. Check all folders


elrrserviceentities
-------------------
      1. Eclipse --> File --> Import --> Git --> Projects from Git --> Clone URI
         a. URI = https://github.com/adlnet/elrr-services-entities.git
         b. User = phleven
         c. Password = phil55.cindy61
         d. Select main branch, deselect all other branches
         e. Local Destination = C:\Users\phleven\git\elrr-services-entities
        
      2. Eclipse --> Show View --> Git Repositories --> Right click on elrr-services-entities [dev-update-branch] C:\Users\phleven\git\elrr-services-entities\.git 
	--> Working Tree - C:\Users\phleven\git\elrr-services-entities\.git --> Import Projects 
         a. Import source = C:\Users\phleven\git\elrr-services-entities
         b. Check all folders
         
      3. Open terminal
         a. cd cd C:\Users\phleven\git\elrr-services-entities
         b. mvn install


java-xapi-tools
---------------
      1. Eclipse --> File --> Import --> Git --> Projects from Git --> Clone URI
         a. URI = https://github.com/yetanalytics/java-xapi-tools.git
         b. User = phleven
         c. Password = phil55.cindy61
         d. Select all branches
         e. Local Destination = C:\Users\phleven\git\java-xapi-tools
        
      2. Eclipse --> Show View --> Git Repositories --> Right click on java-xapi-tools [initial-client] C:\Users\phleven\git\java-xapi-tools\.git 
	--> Working Tree - C:\Users\phleven\git\java-xapi-tools\.git --> Import Projects 
         a. Import source = C:\Users\phleven\git\java-xapi-tools
         b. Check all folders
         
      3. Open terminal
         a. cd cd C:\Users\phleven\git\java-xapi-tools
         b. mvn install
    
    
elrraggregator
--------------
      1. File --> Import --> Git --> Projects from Git --> Clone URI
         a. URI = https://github.com/adlnet/elrr-aggregator.git
         b. User = phleven
         c. Password = phil55.cindy61
         d. Select all branches
         e. Local Destination = C:\Users\phleven\git\elrr-aggregator
        
      2. Eclipse --> Show View --> Git Repositories --> Right click on ellr-aggrigator [dev-update-branch] C:\Users\phleven\git\elrr-aggregator\.git 
	--> Working Tree - C:\Users\phleven\git\elrr-aggregator\.git --> Import Projects 
         a. Import source = C:\Users\phleven\git\elrr-aggregator
         b. Check all folders
        
      3. Eclipse --> Run --> Debug Configurations --> Remote Java Application --> New Launch Configuration (1st button on the left)
         a. Name = Debug 8000
         b. Project = elrr-aggregator
         c. Host = localhost
         d. Port = 8000
         e. Apply
         f. Run from terminal
            1. mvn spring-boot:run -D"spring-boot.run.jvmArgument"s="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000" -D"spring-boot.run.profiles"=local -e
         g. Debug from Eclipse
 
 
 
elrrexternalservices
--------------------
      1. File --> Import --> Git --> Projects from Git --> Clone URI
         a. URI = https://github.com/adlnet/elrr-external-services.git
         b. User = phleven
         c. Password = phil55.cindy61
         d. Select all branches
         e. Local Destination = C:\Users\phleven\git\elrr-external-services
        
      2. Eclipse --> Show View --> Git Repositories --> Right click on ellr-external-services [dev-update-branch] C:\Users\phleven\git\elrr-external-services\.git 
	--> Working Tree - C:\Users\phleven\git\elrr-external-services\.git --> Import Projects 
         a. Import source = C:\Users\phleven\git\elrr-external-services
         b. Check all folders
         
      3. Eclipse --> Run --> Debug Configurations --> Remote Java Application --> New Launch Configuration (1st button on the left)
         a. Name = Debug 8000
         b. Project = elrr-external-services
         c. Host = localhost
         d. Port = 8000
         e. Apply
         f. Run from terminal
            1. mvn spring-boot:run -D"spring-boot.run.jvmArgument"s="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000" -D"spring-boot.run.profiles"=local -e
         g. Debug from Eclipse
 
 

elrrdatasync
------------
      1. File --> Import --> Git --> Projects from Git --> Clone URI
         a. URI = https://github.com/adlnet/elrr-datasync.git
         b. User = phleven
         c. Password = phil55.cindy61
         d. Select all branches
         e. Local Destination = C:\Users\phleven\git\elrr-datasync
         
      2. Eclipse --> Show View --> Git Repositories --> Right click on ellrdatasynch [dev-update-branch] C:\Users\phleven\git\elrr-datasync\.git 
	--> Working Tree - C:\Users\phleven\git\elrr-datasync\.git --> Import Projects 
         a. Import source = C:\Users\phleven\git\elrr-datasync
         b. Check all folders
         
      3. Eclipse --> Run --> Debug Configurations --> Remote Java Application --> New Launch Configuration (1st button on the left)
         a. Name = Debug 8000
         b. Project = elrr-datasync
         c. Host = localhost
         d. Port = 8000
         e. Apply
         f. Run from terminal
            1. mvn spring-boot:run -D"spring-boot.run.jvmArgument"s="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000" -D"spring-boot.run.profiles"=local -e
         g. Debug from Eclipse
      


elrrservices
------------
      1. File --> Import --> Git --> Projects from Git --> Clone URI
         a. URI = https://github.com/adlnet/elrr-services.git
         b. User = phleven
         c. Password = phil55.cindy61
         d. Select all branches
         e. Local Destination = C:\Users\phleven\git\elrr-services
        
      2. Eclipse --> Show View --> Git Repositories --> Right click on ellr-services [dev-update-branch] C:\Users\phleven\git\elrr-services\.git 
	--> Working Tree - C:\Users\phleven\git\elrr-services\.git --> Import Projects 
         a. Import source = C:\Users\phleven\git\elrr-services
         b. Check all folders

      3. Eclipse --> Run --> Debug Configurations --> Remote Java Application --> New Launch Configuration (1st button on the left)
         a. Name = Debug 8000
         b. Project = elrrservices
         c. Host = localhost
         d. Port = 8000
         e. Apply
         f. Run from terminal
            1. mvn spring-boot:run -D"spring-boot.run.jvmArgument"s="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000" -D"spring-boot.run.profiles"=local -e
         g. Debug from Eclipse

   
   
Create elrrdockercompose Docker Containers:
1. Start Docker Desktop
2. Open terminal
   a. cd C:\Dev\elrr_kraft_docker_compose
   b. docker compose up
   c. docker compose logs
   d. Check for new containers in Docker Desktop
      1. elrrdockercompose
         a. sync-db-1
         b. lrs-db-1
         c. services-db-1
         d. lrs-1
         e. kalfka
f. Reboot



Create and populate PostgreSQL service and staging schema:
1. DBeaver --> Database --> New Database Connection --> PostgreSQL
   a. Host = localhost
   b. Port = 5432
   c. Database = service_db
   d. Authentication = Database Native
   e. Username = service_user
   f. Password = service_password
   g. Run service schema.sql
   h. Run insert_jwt_token.sql

2. DBeaver --> Database --> New Database Connection --> PostgreSQL
   a. Host = localhost
   b. Port = 5431
   c. Database = sync_db
   d. Authentication = Database Native
   e. Username = sync_user
   f. Password = sync_password
   g. Run staging schema.sql

3. DBeaver --> Database --> New Database Connection --> PostgreSQL
   a. Host = localhost
   b. Port = 5433
   c. Database = lrsql_db
   d. Authentication = Database Native
   e. Username = username
   f. Password = password



Run elrrServiceEntities
    1. Open terminal
      a. cd C:\Users\phleven\git\elrrserviceentities
      b. git switch <branch>
      c. mvn clean install



Run elrrexternalservices and elrrdatasync:
1. Run elrrexternalservices
   a. Open terminal
      1. cd C:\Users\phleven\git\elrrexternalservices
      2. git switch <branch>
      3. mvn clean install
      4. mvn spring-boot:run -D"spring-boot.run.profiles"=local -e
      	 mvn spring-boot:run -D"spring-boot.run.jvmArgument"s="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000" -D"spring-boot.run.profiles"=local -e
      5. Ctrl+C to end --> Terminate batch job = Y 
      
2. Run elrrdatasynch:
   a. Open terminal
      1. cd C:\Users\phleven\git\elrrdatasync
      2. git switch <branch>
      3. mvn clean install
      4. mvn spring-boot:run -D"spring-boot.run.profiles"=local -e
      	 mvn spring-boot:run -D"spring-boot.run.jvmArgument"s="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000" -D"spring-boot.run.profiles"=local -e
      5. Ctrl+C to end --> Terminate batch job = Y 

3. To test from browser
   a. Open terminal
      1. cd C:\Users\phleven\git\elrrexternalservices
      2. git switch <branch>
      3. mvn clean install
      4. mvn spring-boot:run -D"spring-boot.run.profiles"=local -e
   b. Open browser
      a. http://localhost:8088/api/lrsdata   



Run elrraggregator:
    1. Reboot after datasync runs for the first time!!!
    2. Open terminal
      a. cd C:\Users\phleven\git\elrraggregator
      b. git switch <branch>
      c. mvn clean install
      d. mvn spring-boot:run -D"spring-boot.run.profiles"=local -e
      	 mvn spring-boot:run -D"spring-boot.run.jvmArgument"s="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000" -D"spring-boot.run.profiles"=local -e
      e. Ctrl+C to end --> Terminate batch job = Y 



Run elrrservices:
    1. Open terminal
      a. cd C:\Users\phleven\git\elrrservices
      b. git switch <branch>
      c. mvn clean install
      d. mvn spring-boot:run -D"spring-boot.run.profiles"=local -e
      	 mvn spring-boot:run -D"spring-boot.run.jvmArgument"s="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000" -D"spring-boot.run.profiles"=local -e
      e. Ctrl+C to end --> Terminate batch job = Y 




Application UI:
1. http://localhost:8088/api/lrsdata

2. Yet (lrs) 
   a. http://localhost:8083
      user = my_username
      password = my_password

   b. STATEMENT BROWSER
      1. Credentiails to use = my_key



Run Postman to populate lrs-db:
1. Postman
   phleven
   Cynthia1#

   a. POST http://localhost:8083/xapi/statements
   b. Authorization
      1. Basic Auth
      2. Username = my_key
      3. Password = my_secret
   c. Headers
      1. key = X-Experience-API-Version
      2. value = 1.0.3
   d. Body raw, JSON

Copy and paste elrr_test_xAPI_statements.text into Postman.



View runnung Docker containers:
1. Open terminal
   a. docker ps



List Kafka topics:
1. Open terminal
   a. Get hash for kafka from Docker --> Containers
   b. docker exec -t -i b1f007a72afba0031317c00cc3ebae3d64177d9ba553671f3eceba7b5c74247c /bin/bash
   c. cd /opt/kafka/bin
   d. ./kafka-topics.sh --bootstrap-server=localhost:9092 --list



View Kafka topic details:
1. Open terminal
   a. Get hash for kafka from Docker --> Containers
   b. docker exec -t -i b1f007a72afba0031317c00cc3ebae3d64177d9ba553671f3eceba7b5c74247c /bin/bash
   c. cd /opt/kafka/bin
   d. ./kafka-configs.sh --bootstrap-server localhost:9092 --describe --topic datasync-statements --all
   e. ./kafka-configs.sh --bootstrap-server localhost:9092 --describe --topic datasync-statements --all | grep retention



Delete and Recreate Kafka topic: 
1. Open terminal
   a. Get hash for kafka from Docker --> Containers
   b. docker exec -t -i b1f007a72afba0031317c00cc3ebae3d64177d9ba553671f3eceba7b5c74247c /bin/bash
   c. cd /opt/kafka/bin
   d. ./kafka-topics.sh --delete --topic datasync-statements --bootstrap-server localhost:9092
   e. ./kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic datasync-statements
   f. Stop and restart elrrdockercompose container



Consume Kafka Topic Messages:
1. Open terminal
   a. Get hash for kafka from Docker --> Containers
   b. docker exec -t -i b1f007a72afba0031317c00cc3ebae3d64177d9ba553671f3eceba7b5c74247c /bin/bash
   c. cd /opt/kafka/bin
   d. ./kafka-console-consumer.sh -bootstrap-server localhost:9092 -topic datasync-statements --from-beginning
      ./kafka-console-consumer.sh -bootstrap-server localhost:9092 -topic datasync-statements-dlq --from-beginning      
   e. Ctrl + C to end 


{"statement":{"id":"d9f1328b-bcc2-4b9c-b954-03cb88a240c8","actor":{"objectType":"Agent","name":"Sophia Lewis","mbox":"mailto:sophia.lewis@us.navy.mil"},"verb":{"id":"https://adlnet.gov/expapi/verbs/achieved","display":{"en-us":"Achieved"}},"object":{"objectType":"Activity","id":"https://w3id.org/xapi/credential/GIAC%20Security%20Essentials%20Certification%20%28GSEC%29","definition":{"name":{"en-us":"GIAC Security Essentials Certification (GSEC)"},"type":"https://yetanalytics.com/deloitte-edlm/demo-profile/certificate"}},"authority":{"objectType":"Agent","account":{"homePage":"http://example.org","name":"0193f924-b470-89c9-a5f2-35cd03409e9c"}},"timestamp":"2024-09-20T21:37:23.835Z","stored":"2024-12-24T14:51:40.346Z","version":"1.0.0"}


KafkaMagic:
1. Start Docker
2. Run "C:\Dev\KafkaMagic_win-x64\KafkaMagic.exe"
3. Register New
   a. Name = Kafka
   b. Bootstrap Server = localhost:9092



Re-run creating Kafka message
1. Truncate and re-populate synch_db staging tables (synch_db_insert.sql)
2. Make sure import.importenddate < import.lastmodified
3. Truncate and re-populate service_db tables (service_db_insert.sql)
4. Starts with LRSSyncSChedulingService.run() --> NewDataSevice.process()
5. ELRRMessageListener.listen()
